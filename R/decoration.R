#' Add decorations to spectrum plot (private)
#'
#' Add decorations to plots generated by the plot() methods defined in this
#' package. It collects code that is common to plot methods for different types
#' of spectra but as it may change in the future it is not exported.
#'
#' @param w.band waveband object or list of waveband objects
#' @param ymax,ymin numeric
#' @param annotations character vector
#' @param label.qty character
#' @param summary.label character
#'
#' @keywords internal
#'
#' @return A list of ggplot "components" that can be added to a ggplot object
#'   with operator "+". The length of the list depends on the value of argument
#'   \code{annotations} and the class of argument for \code{spct} used in the
#'   call.
#'
decoration <- function(w.band,
                       y.max,
                       y.min,
                       x.max,
                       x.min,
                       annotations,
                       label.qty,
                       summary.label
                       ) {
  z <- list()
  if ("peaks" %in% annotations) {
    z <- c(z, stat_peaks(span = 21, label.fmt = "%3.0f",
                              ignore_threshold = 0.02, color = "red",
                              geom = "text", vjust = -0.5, size = 2.5))
  }
  if ("valleys" %in% annotations) {
    z <- c(z, stat_valleys(span = 21, label.fmt = "%3.0f",
                                ignore_threshold = 0.02, color = "blue",
                                geom = "text", vjust = +1.2, size = 2.5))
  }
  if (!is.null(annotations) &&
      length(intersect(c("labels", "summaries", "colour.guide", "boxs", "segments"),
                       annotations)) > 0L) {
    z <- c(z, ylim(y.min, y.max * 1.25), xlim(x.min - (x.max - x.min) * 0.035, x.max))
  }
  if ("colour.guide" %in% annotations) {
    z <- c(z, stat_wl_strip(ymax = y.max * 1.26, ymin = y.max * 1.22))
  }
  if ("boxes" %in% annotations) {
    z <- c(z, stat_wl_strip(w.band = w.band,
                                    ymax = y.max * 1.20,
                                    ymin = y.max * 1.08,
                                    color = "white",
                                    linetype = "solid"
    ))
    label.color <- "white"
    pos.shift <- 0.00
  }

  if ("segments" %in% annotations) {
    z <- c(z, stat_wl_strip(w.band = w.band,
                                    ymax = y.max * 1.10,
                                    ymin = y.max * 1.07,
                                    color = "white",
                                    linetype = "solid"
    ))
    label.color <- "black"
    pos.shift <- 0.01
  }

  if ("labels" %in% annotations && "summaries" %in% annotations) {
    z <- c(z, stat_wb_summary(geom = "text",
                                 w.band = w.band,
                                 y.position = y.max * 1.143 + pos.shift,
                                 integral.fun = label.qty,
                                 color = label.color,
                                 aes(label = paste(..wb.name.., ..y.label.., sep = "\n")),
                                 size = rel(2)))
  } else {
    if ("labels" %in% annotations) {
      z <- c(z, stat_wb_summary(geom = "text",
                                   w.band = w.band,
                                   y.position = y.max * 1.143 + pos.shift,
                                   integral.fun = label.qty,
                                   color = label.color,
                                   aes_(label = ~..wb.name..),
                                   size = rel(2)))
    }
    if ("summaries" %in% annotations) {
      z <- c(z,  stat_wb_summary(geom = "text",
                                   w.band = w.band,
                                   y.position = y.max * 1.143 + pos.shift,
                                   integral.fun = label.qty,
                                   color = label.color,
                                   aes_(label = ~..y.label..),
                                   size = rel(2)))
    }
  }

  if ("summaries" %in% annotations) {
    z <- c(z,
      annotate("text",
               x = x.min, y = y.max * 1.09 + 0.5 * y.max * 0.085,
               size = rel(2), vjust = -0.3, hjust = 0.5, angle = 90,
               label = summary.label, parse = TRUE))
  }

  z
}